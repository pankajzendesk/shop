generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/client"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                 String        @id @default(cuid())
  name               String
  email              String        @unique
  phone              String?       @unique
  password           String?
  role               String        @default("user")
  avatar             String?
  createdAt          DateTime      @default(now())
  updatedAt          DateTime      @updatedAt
  gender             String?
  preferences        Json?
  lastName           String?
  isActive           Boolean       @default(true)
  addresses          Address[]
  assignedDeliveries Order[]       @relation("DeliveryChampion")
  assignedShipments  Order[]       @relation("ShipmentPerson")
  posSales           Order[]       @relation("StaffPOS")
  orders             Order[]
  transactions       Transaction[]
}

model Address {
  id           String  @id @default(cuid())
  fullName     String
  addressLine1 String
  addressLine2 String?
  city         String
  state        String
  country      String  @default("India")
  zipCode      String
  phone        String
  isDefault    Boolean @default(false)
  userId       String
  user         User    @relation(fields: [userId], references: [id])
}

model Product {
  id            String            @id @default(cuid())
  name          String
  price         Float
  originalPrice Float?
  rating        Float             @default(4.5)
  reviewCount   Int               @default(0)
  image         String
  images        String[]
  alt           String?
  category      String
  brand         String
  ageGroup      String
  inStock       Boolean           @default(true)
  isNew         Boolean           @default(false)
  discount      Int?
  description   String?
  features      String[]
  quantity      Int               @default(0)
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt
  returnPolicy  String            @default("NONE")
  trendingItems TrendingProduct[]
}

model Order {
  id                  String         @id @default(cuid())
  date                DateTime       @default(now())
  status              String         @default("Pending")
  total               Float
  shippingAddress     String?
  paymentMethod       String?
  carrier             String?
  trackingNumber      String?
  userId              String?
  email               String?
  customerName        String?
  createdAt           DateTime       @default(now())
  updatedAt           DateTime       @updatedAt
  cancelReason        String?
  refundAmount        Float?
  returnReason        String?
  returnType          String?
  returnStatus        String?
  shippingCost        Float?         @default(0)
  taxAmount           Float?         @default(0)
  assignedDeliveryId  String?
  deliveryOTP         String?
  handoverCode        String?
  assignedShipmentId  String?
  failureReason       String?
  deliveryImage       String?
  paymentCollected    Boolean        @default(false)
  refundPaymentMethod String?
  returnOTP           String?
  returnHandoverCode  String?
  discountAmount      Float?         @default(0)
  promoCode           String?
  customerPhone       String?
  source              String         @default("ONLINE")
  sourceStaffId       String?
  
  assignedDelivery    User?          @relation("DeliveryChampion", fields: [assignedDeliveryId], references: [id])
  assignedShipment    User?          @relation("ShipmentPerson", fields: [assignedShipmentId], references: [id])
  sourceStaff         User?          @relation("StaffPOS", fields: [sourceStaffId], references: [id])
  user                User?          @relation(fields: [userId], references: [id])
  statusHistory       OrderHistory[]
  items               OrderItem[]
  transaction         Transaction?
}

model OrderHistory {
  id        String   @id @default(cuid())
  orderId   String
  status    String
  timestamp DateTime @default(now())
  note      String?
  order     Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([orderId])
}

model Transaction {
  id             String   @id @default(cuid())
  orderId        String   @unique
  userId         String?
  amount         Float
  currency       String   @default("INR")
  paymentMethod  String
  status         String   @default("Pending")
  transactionId  String?  @unique
  paymentDetails Json?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  order          Order    @relation(fields: [orderId], references: [id])
  user           User?    @relation(fields: [userId], references: [id])
}

model Carrier {
  id   String @id @default(cuid())
  name String @unique
}

model Banner {
  id        String   @id @default(cuid())
  title     String
  subtitle  String
  image     String
  link      String?  @default("/")
  active    Boolean  @default(true)
  createdAt DateTime @default(now())
}

model Deal {
  id        String   @id @default(cuid())
  name      String
  price     String
  image     String
  offer     String
  active    Boolean  @default(true)
  createdAt DateTime @default(now())
}

model Coupon {
  id         String   @id @default(cuid())
  code       String   @unique
  discount   Float
  type       String
  expiry     DateTime
  usageCount Int      @default(0)
  status     String   @default("Active")
  bgImg      String?
  createdAt  DateTime @default(now())
}

model NavCategory {
  id           String @id @default(cuid())
  name         String
  img          String
  href         String
  displayOrder Int    @default(0)
}

model ProductCategory {
  id   String @id @default(cuid())
  name String @unique
}

model ExperienceTile {
  id    String @id @default(cuid())
  name  String
  image String
  color String @default("bg-primary")
}

model TrendingProduct {
  id        String  @id @default(cuid())
  productId String
  tag       String  @default("Fast Seller")
  product   Product @relation(fields: [productId], references: [id])
}

model TrafficRecord {
  id        String   @id @default(cuid())
  timestamp DateTime @default(now())
  path      String
  userId    String?
  userName  String?
  ip        String?
  country   String?
  city      String?
  device    String?
  userAgent String?
  userEmail String?
}

model PaymentMethod {
  id          String   @id @default(cuid())
  name        String   @unique
  identifier  String   @unique
  icon        String?
  isActive    Boolean  @default(true)
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model OrderItem {
  id           String  @id @default(cuid())
  orderId      String
  productId    String
  name         String
  price        Float
  quantity     Int
  image        String
  returnPolicy String? @default("NONE")
  order        Order   @relation(fields: [orderId], references: [id])
}

model InventoryLog {
  id          String   @id @default(cuid())
  productId   String
  productName String
  oldQuantity Int
  newQuantity Int
  change      Int
  type        String
  timestamp   DateTime @default(now())
}

model StoreSettings {
  id                   String   @id @default("global")
  taxEnabled           Boolean  @default(false)
  taxPercentage        Float    @default(0)
  taxName              String   @default("GST")
  requireDeliveryPhoto Boolean  @default(false)
  updatedAt            DateTime @updatedAt
}
